

# 模块 4：审核数据库

## 练习 1：为你的数据库启用审核

### 任务 1：实验设置

1.  打开 **PowerShell**，然后运行以下命令以部署实验数据库：

     ```powershell
    开始 "https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FMicrosoftLearning%2FAZ-500-Azure-Security%2Fmaster%2FAllfiles%2FLabs%2FMod4_Lab02%2Fazuredeploy.json" 
     ```

1.  在**“资源组”**下单击“新建”，并使用默认名称 "**Mod4Lab2**"

1.  你可以使用默认填充的 SQL Server 名称

1.  请单击**“购买”**
警告
**注**：你必须等待包含测试数据的 SQL 数据库部署

### 任务 2：启用你数据库上的审核

1.  选择你在实验设置中创建的资源组

2.  **选择** SQL server **az500labserver2**

3.  在**“安全”**下，选择**“审核”**。

4.  将**“审核”**切换到**“打开”**。

5.  选择存储作为发送审核日志的位置

6.  **单击配置**

7.  选择**“你的订阅”**

8.  请单击**“新建”**。

9.  将订阅命名为 "**mod4lab2YOURNAME**" 以创建唯一名称

10. 单击**确定**。

11. 将保留天数更改为 **5**，然后单击**“确定”** 

12. 请单击**“保存”**，保存**“审核配置”**

## 练习 2：查看审核日志

### 任务 1：查看 SQL DB 上的审核日志。

1.  要查看数据库的审核日志，请返回实验设置中创建的资源组

1.  请单击 **AZ500LabDb (az500labserver2/AZ500LabDb)**，选择你的测试数据库

1.  请单击**“审核”**
警告
**注意**：“审核”在这里似乎处于关闭状态，但是它是在基础服务器级别上设置的，因此已为此数据库打开


1.  **单击**查看**“审核日志”**。
警告
**注意**：在这里，你将查看 Db 审核日志的输出，包括任何尝试的 SQL注入，因为这是不久前创建的测试数据库，因此如果当前在日志中有任何审核，则将进行最少审核。
如果启用了服务器审核，则数据库配置审核将与服务器审核并行存在。
请注意，你可以选择将审核日志写入 Azure 存储帐户，将其写入日志分析工作区以供 Azure Monitor 日志使用，或选择要使用事件中心进行使用的事件中心。你可以配置这些选项的任意组合，并将审核日志写入每个选项。



**“结果”**：现在，你已经在 SQL 数据库上设置了审核，并审查了在何处查看审核输出
